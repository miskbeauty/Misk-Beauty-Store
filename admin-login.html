<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - تسجيل الدخول | مسك بيوتي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/admin.css">
</head>

<body class="login-page">
    <div class="login-card">
        <img src="assets/images/1745215944148877862-removebg-preview.png" alt="Misk Beauty Logo" class="login-logo">
        <h1 class="login-title">تسجيل دخول المسؤول</h1>

        <form id="adminLoginForm" onsubmit="handleAdminLogin(event)">
            <div class="admin-form-group">
                <label for="username">اسم المستخدم</label>
                <input type="text" id="username" class="admin-input" placeholder="أدخل اسم المستخدم" required>
            </div>

            <div class="admin-form-group">
                <label for="password">كلمة المرور</label>
                <input type="password" id="password" class="admin-input" placeholder="••••••••" required>
            </div>

            <div class="admin-form-group" style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" id="rememberMe" style="width: 18px; height: 18px; cursor: pointer;">
                <label for="rememberMe" style="margin-bottom: 0px; cursor: pointer;">البقاء متصلاً</label>
            </div>

            <button type="submit" class="btn-admin-login">دخول للوحة التحكم</button>
        </form>

        <p style="margin-top: 25px; color: #888; font-size: 0.9rem;">
            خاص بالموظفين المصرح لهم فقط.
        </p>
    </div>

    <script>
        /**
         * Security Configuration (Hidden Layout)
         * In a real backend, these would be managed server-side.
         */
        const ADMIN_CONFIG = {
            recoveryEmail: "owner@miskbeauty.com", // Link for password recovery
            sessionDurationHours: 24,            // Persistent session for workflow
            encryptionPrep: true                  // Ready for future hashing integration
        };

        async function handleAdminLogin(e) {
            e.preventDefault();
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            const loginBtn = document.querySelector('.btn-admin-login');

            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الدخول...';

            try {
                const response = await fetch('/api/auth/admin-login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: user, password: pass })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    const sessionData = {
                        status: 'active',
                        loginTime: Date.now(),
                        user: user,
                        token: data.token, // Essential for API calls
                        persistent: rememberMe
                    };

                    localStorage.setItem('misk_admin_session', JSON.stringify(sessionData));
                    window.location.href = 'admin-dashboard.html';
                } else {
                    alert(data.message || 'اسم المستخدم أو كلمة المرور غير صحيحة');
                }
            } catch (error) {
                console.error("Login error:", error);
                alert('فشل الاتصال بالخادم: ' + error.message);
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = 'دخول للوحة التحكم';
            }
        }
    </script>
</body>

</html>