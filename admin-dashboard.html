<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم | مسك بيوتي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/admin.css">
</head>

<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar Navigation -->
        <aside class="admin-sidebar">
            <div class="sidebar-logo">
                <img src="assets/images/1745215944148877862-removebg-preview.png" alt="Misk Beauty Logo">
                <h3 style="color: #6a1b9a; font-size: 0.9rem; margin-top: 10px;">إدارة مسك بيوتي</h3>
            </div>

            <ul class="sidebar-menu">
                <li class="menu-item active" id="menu-orders">
                    <a href="#" onclick="switchTab('orders')">
                        <i class="fas fa-shopping-bag"></i>
                        <span>إدارة الطلبات</span>
                    </a>
                </li>
                <li class="menu-item" id="menu-products">
                    <a href="#" onclick="switchTab('products')">
                        <i class="fas fa-box-open"></i>
                        <span>إدارة المنتجات</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#">
                        <i class="fas fa-users"></i>
                        <span>العملاء</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#">
                        <i class="fas fa-cog"></i>
                        <span>الإعدادات</span>
                    </a>
                </li>
                <li class="menu-item" style="margin-top: 50px;">
                    <a href="admin-login.html" onclick="localStorage.removeItem('misk_admin_session')">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>تسجيل الخروج</span>
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content Area -->
        <main class="admin-main">
            <!-- Top Header -->
            <header class="dashboard-header">
                <div>
                    <h1 style="font-size: 1.8rem; font-weight: 700;">أهلاً بك، المدير</h1>
                    <p style="color: #636e72;">نظرة عامة على نشاط المتجر اليوم.</p>
                </div>

                <div class="admin-user-info">
                    <div class="user-details" style="text-align: left;">
                        <span style="display: block; font-weight: 700;">أحمد محمد</span>
                        <span style="font-size: 0.8rem; color: #888;">مدير المتجر</span>
                    </div>
                    <div class="user-avatar">AD</div>
                </div>
            </header>

            <!-- Quick Stats -->
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon bg-purple">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="stat-info">
                        <h4>إجمالي الطلبات</h4>
                        <span>124</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-pink">
                        <i class="fas fa-shekel-sign"></i>
                    </div>
                    <div class="stat-info">
                        <h4>المبيعات (شيكل)</h4>
                        <span>4,820</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon bg-gold">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <div class="stat-info">
                        <h4>زوار اليوم</h4>
                        <span>352</span>
                    </div>
                </div>
            </section>

            <!-- Orders Management Table -->
            <section id="orders-section" class="admin-card">
                <div class="card-header">
                    <h3 style="font-weight: 700;">إدارة الطلبات</h3>
                    <div class="header-actions">
                        <button class="btn-admin-login"
                            style="padding: 8px 15px; font-size: 0.9rem; width: auto; box-shadow: none;">تصدير
                            البيانات</button>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>رقم الطلب</th>
                                <th>التاريخ</th>
                                <th>الاسم</th>
                                <th>المنطقة/المدينة</th>
                                <th>الإجمالي</th>
                                <th>الحالة</th>
                                <th>العمليات</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <!-- Data populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Product Management Table -->
            <section id="products-section" class="admin-card hidden">
                <div class="card-header">
                    <h3 style="font-weight: 700;">إدارة المنتجات</h3>
                    <div class="header-actions">
                        <button onclick="openProductModal()" class="btn-admin-login"
                            style="padding: 8px 15px; font-size: 0.9rem; width: auto; box-shadow: none;">
                            <i class="fas fa-plus"></i> إضافة منتج جديد
                        </button>
                    </div>
                </div>

                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>صورة المنتج</th>
                                <th>الاسم</th>
                                <th>التصنيف</th>
                                <th>السعر</th>
                                <th>المخزون</th>
                                <th>العمليات</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <!-- Data populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <!-- Order Details Modal -->
    <div id="order-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-order-number">تفاصيل الطلب</h3>
                <button class="close-modal" onclick="closeModal('order-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="details-grid">
                    <div class="detail-item">
                        <span class="detail-label">اسم العميل</span>
                        <span class="detail-value" id="detail-name">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">رقم الواتساب</span>
                        <span class="detail-value" id="detail-whatsapp">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">المدينة/المنطقة</span>
                        <span class="detail-value" id="detail-city">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">التاريخ</span>
                        <span class="detail-value" id="detail-date">-</span>
                    </div>
                    <div class="detail-item full-width">
                        <span class="detail-label">العنوان بالتفصيل</span>
                        <span class="detail-value" id="detail-address">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">المبلغ الإجمالي</span>
                        <span class="detail-value" id="detail-total">-</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">الحالة الحالية</span>
                        <span id="detail-status-badge" class="status-badge">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal (Add/Edit) -->
    <div id="product-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">إضافة منتج جديد</h3>
                <button class="close-modal" onclick="closeModal('product-modal')">&times;</button>
            </div>
            <form id="product-form" onsubmit="handleProductSubmit(event)">
                <input type="hidden" id="product-id">
                <div class="modal-body">
                    <div class="details-grid">
                        <div class="admin-form-group full-width">
                            <label>اسم المنتج</label>
                            <input type="text" id="prod-name" class="admin-input" required>
                        </div>
                        <div class="admin-form-group">
                            <label>السعر (شيكل)</label>
                            <input type="number" id="prod-price" class="admin-input" required>
                        </div>
                        <div class="admin-form-group">
                            <label>المخزون</label>
                            <input type="number" id="prod-stock" class="admin-input" required>
                        </div>
                        <div class="admin-form-group">
                            <label>التصنيف</label>
                            <select id="prod-category" class="admin-input" required>
                                <option value="عطور">عطور</option>
                                <option value="عناية وجمال">عناية وجمال</option>
                                <option value="حقائب وإكسسوارات">حقائب وإكسسوارات</option>
                                <option value="هدايا">هدايا</option>
                                <option value="طباعة حرارية">طباعة حرارية</option>
                            </select>
                        </div>
                        <div class="admin-form-group">
                            <label>رابط الصورة</label>
                            <input type="text" id="prod-image" class="admin-input" placeholder="رابط خارجي أو مسار محلي"
                                required>
                        </div>
                        <div class="admin-form-group full-width">
                            <label>الوصف</label>
                            <textarea id="prod-desc" class="admin-input"></textarea>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-cancel" onclick="closeModal('product-modal')">إلغاء</button>
                    <button type="submit" class="btn-admin-login" style="width: auto; padding: 10px 30px;">حفظ
                        المنتج</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Mock Data ---
        let mockOrders = [
            {
                id: "10521",
                date: "2024-01-29",
                customer: "ياسر الأحمد",
                whatsapp: "+970 599 123 456",
                city: "عقربا، نابلس",
                address: "شارع المدارس، عمارة الأمل، ط2",
                total: "120 شيكل",
                status: "waiting"
            },
            {
                id: "10522",
                date: "2024-01-28",
                customer: "سارة محمود",
                whatsapp: "+970 568 987 654",
                city: "القدس، شارع الزهراء",
                address: "فوق صيدلية القدس، شقة 4",
                total: "315 شيكل",
                status: "preparing"
            },
            {
                id: "10523",
                date: "2024-01-28",
                customer: "محمد علي",
                whatsapp: "+970 592 111 222",
                city: "رام الله، المصيف",
                address: "بالقرب من سوبر ماركت برافو",
                total: "85 شيكل",
                status: "shipped"
            },
            {
                id: "10524",
                date: "2024-01-27",
                customer: "لينا عودة",
                whatsapp: "+970 597 444 555",
                city: "نابلس، رفيديا",
                address: "دخلة جامعة النجاح القديمة",
                total: "250 شيكل",
                status: "delivered"
            }
        ];

        let mockProducts = [
            {
                id: 1,
                name: "عطر مسك فاخر",
                category: "عطور",
                price: 85,
                stock: 24,
                image: "assets/images/perfume-sample.jpg",
                desc: "عطر مسك مميز يدوم طويلاً"
            },
            {
                id: 2,
                name: "مجموعة العناية بالبشرة",
                category: "عناية وجمال",
                price: 150,
                stock: 12,
                image: "assets/images/beauty-set.jpg",
                desc: "مجموعة متكاملة لتنظيف وترطيب البشرة"
            },
            {
                id: 3,
                name: "حقيبة يد عصرية",
                category: "حقائب وإكسسوارات",
                price: 120,
                stock: 8,
                image: "assets/images/bag-sample.jpg",
                desc: "حقيبة جلدية فاخرة بألوان جذابة"
            }
        ];

        const statusMap = {
            'waiting': 'بانتظار التأكيد',
            'preparing': 'قيد التجهيز',
            'shipped': 'تم الشحن',
            'delivered': 'تم التوصيل'
        };

        // --- Core Functions ---

        function switchTab(tab) {
            const ordersSec = document.getElementById('orders-section');
            const productsSec = document.getElementById('products-section');
            const menuOrders = document.getElementById('menu-orders');
            const menuProducts = document.getElementById('menu-products');

            if (tab === 'orders') {
                ordersSec.classList.remove('hidden');
                productsSec.classList.add('hidden');
                menuOrders.classList.add('active');
                menuProducts.classList.remove('active');
                renderOrders();
            } else {
                ordersSec.classList.add('hidden');
                productsSec.classList.remove('hidden');
                menuOrders.classList.remove('active');
                menuProducts.classList.add('active');
                renderProducts();
            }
        }

        function renderOrders() {
            const tableBody = document.getElementById('orders-table-body');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            mockOrders.forEach(order => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>#${order.id}</td>
                    <td>${order.date}</td>
                    <td>${order.customer}</td>
                    <td>${order.city}</td>
                    <td>${order.total}</td>
                    <td>
                        <select class="status-select" onchange="updateStatus('${order.id}', this.value)">
                            <option value="waiting" ${order.status === 'waiting' ? 'selected' : ''}>بانتظار التأكيد</option>
                            <option value="preparing" ${order.status === 'preparing' ? 'selected' : ''}>قيد التجهيز</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>تم الشحن</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>تم التوصيل</option>
                        </select>
                    </td>
                    <td style="text-align: center;">
                        <button onclick="viewDetails('${order.id}')" style="background:none; border:none; cursor:pointer;">
                            <i class="fas fa-eye" style="color: #6a1b9a; font-size: 1.1rem;"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        function updateStatus(orderId, newStatus) {
            const order = mockOrders.find(o => o.id === orderId);
            if (order) {
                order.status = newStatus;
                alert(`تم تحديث حالة الطلب #${orderId} إلى: ${statusMap[newStatus]}`);
            }
        }

        function viewDetails(orderId) {
            const order = mockOrders.find(o => o.id === orderId);
            if (order) {
                document.getElementById('modal-order-number').innerText = `تفاصيل الطلب #${order.id}`;
                document.getElementById('detail-name').innerText = order.customer;
                document.getElementById('detail-whatsapp').innerText = order.whatsapp;
                document.getElementById('detail-city').innerText = order.city;
                document.getElementById('detail-date').innerText = order.date;
                document.getElementById('detail-address').innerText = order.address;
                document.getElementById('detail-total').innerText = order.total;

                const badge = document.getElementById('detail-status-badge');
                badge.className = `status-badge status-${order.status}`;
                badge.innerText = statusMap[order.status];

                document.getElementById('order-modal').style.display = 'flex';
            }
        }

        // --- Product Management Logic ---

        function renderProducts() {
            const tableBody = document.getElementById('products-table-body');
            if (!tableBody) return;
            tableBody.innerHTML = '';

            mockProducts.forEach(prod => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td><img src="${prod.image}" class="product-thumb" onerror="this.src='https://placehold.co/50x50?text=Logo'"></td>
                    <td>${prod.name}</td>
                    <td>${prod.category}</td>
                    <td>${prod.price} شيكل</td>
                    <td>${prod.stock}</td>
                    <td>
                        <button onclick="openProductModal(${prod.id})" style="background:none; border:none; cursor:pointer; color: #2e7d32; margin-left: 10px;">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="deleteProduct(${prod.id})" style="background:none; border:none; cursor:pointer; color: #d32f2f;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        function openProductModal(id = null) {
            const form = document.getElementById('product-form');
            form.reset();
            document.getElementById('product-id').value = id || '';
            document.getElementById('product-modal-title').innerText = id ? 'تعديل المنتج' : 'إضافة منتج جديد';

            if (id) {
                const prod = mockProducts.find(p => p.id === id);
                if (prod) {
                    document.getElementById('prod-name').value = prod.name;
                    document.getElementById('prod-price').value = prod.price;
                    document.getElementById('prod-stock').value = prod.stock;
                    document.getElementById('prod-category').value = prod.category;
                    document.getElementById('prod-image').value = prod.image;
                    document.getElementById('prod-desc').value = prod.desc || '';
                }
            }

            document.getElementById('product-modal').style.display = 'flex';
        }

        function handleProductSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('product-id').value;
            const newProd = {
                id: id ? parseInt(id) : Date.now(),
                name: document.getElementById('prod-name').value,
                price: parseInt(document.getElementById('prod-price').value),
                stock: parseInt(document.getElementById('prod-stock').value),
                category: document.getElementById('prod-category').value,
                image: document.getElementById('prod-image').value,
                desc: document.getElementById('prod-desc').value
            };

            if (id) {
                const index = mockProducts.findIndex(p => p.id === parseInt(id));
                mockProducts[index] = newProd;
                alert('تم التحديث بنجاح');
            } else {
                mockProducts.push(newProd);
                alert('تم الإضافة بنجاح');
            }

            closeModal('product-modal');
            renderProducts();
        }

        function deleteProduct(id) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                mockProducts = mockProducts.filter(p => p.id !== id);
                renderProducts();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- Session & Init ---
        function verifyAdminSession() {
            const sessionDataString = localStorage.getItem('misk_admin_session');
            if (!sessionDataString) {
                window.location.href = 'admin-login.html';
                return;
            }
            const sessionData = JSON.parse(sessionDataString);
            const now = Date.now();
            const sessionHours = (now - sessionData.loginTime) / (1000 * 60 * 60);

            if (!sessionData.persistent && sessionHours > 2) {
                localStorage.removeItem('misk_admin_session');
                window.location.href = 'admin-login.html';
                return;
            }

            if (sessionHours > 24) {
                localStorage.removeItem('misk_admin_session');
                window.location.href = 'admin-login.html';
                return;
            }
        }

        // Initialize
        window.onclick = function (event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.style.display = 'none';
            }
        }

        verifyAdminSession();
        renderOrders();
    </script>
</body>

</html>
</body>

</html>